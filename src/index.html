<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <title>React Webpack Template Title</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src='./sources/jquery3.1.1.min.js'></script>
    <script src='./sources/d3.custom.js'></script>
    <script src='./sources/socket.io.js'></script>
    <!--获取地理位置 script-->
    <!--参考地址：http://www.jb51.net/article/58654.htm-->
    <!--<script src="http://pv.sohu.com/cityjson?ie=utf-8">
        // alert(returnCitySN.cname)
    </script>-->
    <script src='http://pv.sohu.com/cityjson'>
        // alert(returnCitySN.cname)
        // alert(returnCitySN.cip)
    </script>
    <!--<script src='http://int.dpool.sina.com.cn/iplookup/iplookup.php?format=js'>
        // alert(remote_ip_info.city)
    </script>-->
</head>

<body>
    <div id="app">APPLICATION CONTENT</div>

    <script>
        __REACT_DEVTOOLS_GLOBAL_HOOK__ = parent.__REACT_DEVTOOLS_GLOBAL_HOOK__
    </script>

    <script src='./sources/common.js'></script>
    <script src='./sources/earth.js'></script>
    <script src='./sources/chat.js'></script>
    <script type="text/javascript" src="/assets/app.js"></script>
    <script>
        $(function() {
            // Chat.init('yeyuguo')

            var defer = $.Deferred()
                // defer.resolve()

            // $('#loginBox form').submit(function(resp) {
            //     var loginUserObj = createLoginObj()
            //     console.log('loginUserObj:', loginUserObj)
            //         // Chat.init(loginUserObj);
            //         // Chat.init(username);
            //     $('#loginBox input[type="text"]').val('')
            //     $('#loginBox').hide();
            //     return false;
            // })


            // TODO，为解决地球仪和对话框的上下层级问题，暂计划手势控制；
            // 两指合拢，把地球仪的z-index放下面，两指拉伸，地球仪的z-index 浮上来
            var ip = returnCitySN.cip || '61.51.81.123'
            Common.getAjax({
                    url: 'http://api.map.baidu.com/location/ip?&coor=bd09ll&ak=sGKjmnRedwEAgCQ2OWlOMGuqKkTpneED&ip=' + ip,
                    dataType: 'jsonp'
                }, function(result) {
                    var lonlat = result.content.point
                    var lon = lonlat.x
                    var lat = lonlat.y
                    console.log(redraw)
                        // redraw([lon, lat])
                    var paramsObj = {
                            point: [lon, lat],
                            msg: 'aaa',
                            avatar: 'images/t2.png',
                        }
                        // paramsObj.point = [110, 30]
                        // Earth.redraw(paramsObj);
                })
                // 地球仪显示 信息
            var testObj = {
                msg: 'lalalalala',
                point: [130, 24],
                avatar: 'images/t2.png'
            }
            Earth.markMsg(testObj)
                // 关闭头像

            function createLoginObj(obj) {
                if (obj) return obj;
                var username = $('#loginBox input[type="text"]').val()
                if (!username) {
                    var randomNum = parseInt(Math.random() * 10000)
                    username = `懒鬼${randomNum}`
                }
                var userAge = $('.userAge').val() || '20'
                var userAddr = $('.userAddr').val() || '云南省昆明市'
                var userSchool = $('.userSchool').val() || '昆明市第一中学'

                var loginUserObj = {
                    username: username,
                    userAge: userAge,
                    userAddr: userAddr,
                    userSchool: userSchool
                }
                return loginUserObj
            }

        })
    </script>
</body>

</html>